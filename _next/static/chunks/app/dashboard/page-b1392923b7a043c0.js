(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7702],{14145:function(e,t,a){Promise.resolve().then(a.bind(a,72218))},72218:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return h}});var s=a(57437),r=a(18628),l=a(24033),n=a(2265),i=a(14958),d=a(31580),o=a(45379),c=a(98906),x=a(74826),g=a(25283),m=a(75571);function h(){let{user:e,loading:t}=(0,r.useAuth)(),a=(0,l.useRouter)(),[h,u]=(0,n.useState)({totalEntries:0,currentStreak:0,longestStreak:0,totalWords:0}),[y,p]=(0,n.useState)({activeHabits:0,completionRate:0,longestStreak:0,totalCompletions:0,mostConsistentHabit:null}),[f,b]=(0,n.useState)({daily:0,weekly:0,monthly:0,total:0,topTags:[]}),[v,j]=(0,n.useState)([]),[N,k]=(0,n.useState)({});(0,n.useEffect)(()=>{t||e||a.push("/")},[e,t,a]),(0,n.useEffect)(()=>{e&&(w(),M(),D(),S())},[e]);let w=async()=>{try{let{data:t,error:a}=await i.O.from("entries").select("createdat, content").eq("user_id",e.id).eq("type","journal").order("createdat",{ascending:!1});if(a)throw a;let s=(null==t?void 0:t.length)||0,r=(null==t?void 0:t.reduce((e,t)=>{var a,s;return e+((null===(s=t.content)||void 0===s?void 0:null===(a=s.match(/\b\w+\b/g))||void 0===a?void 0:a.length)||0)},0))||0,l=0,n=new Date,c=(0,d.WU)(n,"yyyy-MM-dd"),x=(0,d.WU)((0,o.k)(n,1),"yyyy-MM-dd");if(t&&t.length>0){let e=t.some(e=>(0,d.WU)(new Date(e.createdat),"yyyy-MM-dd")===c),a=t.some(e=>(0,d.WU)(new Date(e.createdat),"yyyy-MM-dd")===x);if(e||a){l=1;let a=e?x:(0,d.WU)((0,o.k)(n,2),"yyyy-MM-dd");for(let e=1;e<t.length;e++)if((0,d.WU)(new Date(t[e].createdat),"yyyy-MM-dd")===a)l++,a=(0,d.WU)((0,o.k)(new Date(a),1),"yyyy-MM-dd");else break}}let g=l,m=1;for(let e=1;e<((null==t?void 0:t.length)||0);e++){let a=new Date(t[e-1].createdat),s=new Date(t[e].createdat),r=Math.floor((a.getTime()-s.getTime())/864e5);1===r?(m++,g=Math.max(g,m)):m=1}u({totalEntries:s,currentStreak:l,longestStreak:g,totalWords:r})}catch(e){console.error("Error loading journal stats:",e)}},M=async()=>{try{console.log("Loading habit stats for user:",e.id);let{data:t,error:a}=await i.O.from("habits_total").select("*").eq("user_id",e.id).single();if(a){console.error("Habit totals query error:",a),console.error("Error details:",a.details),console.error("Error hint:",a.hint),console.error("Error message:",a.message),b({daily:0,weekly:0,monthly:0,total:0,topTags:[]});return}console.log("Fetched habit totals:",t);let s={daily:(null==t?void 0:t.dailyhabits)||0,weekly:(null==t?void 0:t.weeklyhabits)||0,monthly:(null==t?void 0:t.monthlyhabits)||0,total:(null==t?void 0:t.totalhabits)||0,topTags:[]};console.log("Setting habit counts:",s),b(s);let{data:r,error:l}=await i.O.from("entries").select("\n          id,\n          title,\n          content,\n          period,\n          createdat,\n          updatedat,\n          user_id,\n          type\n        ").eq("user_id",e.id).eq("type","habit");if(l)throw console.error("Habits query error:",l),l;if(!r||0===r.length){p({activeHabits:0,completionRate:0,longestStreak:0,totalCompletions:0,mostConsistentHabit:null});return}let n=r.map(e=>e.id),{data:d,error:o}=await i.O.from("streaks_view").select("entry_id, completed_at").eq("user_id",e.id).in("entry_id",n);if(o)throw console.error("Completions query error:",o),o;let c=r.length,x=(null==d?void 0:d.length)||0,g=r.reduce((e,t)=>{let a=(null==d?void 0:d.filter(e=>e.entry_id===t.id))||[],s=C(t.period,new Date(t.createdat));return e+a.length/s},0)/c,m=r.reduce((e,t)=>{let a=(null==d?void 0:d.filter(e=>e.entry_id===t.id).map(e=>new Date(e.completed_at)).sort((e,t)=>e.getTime()-t.getTime()))||[],s=1,r=1;for(let e=1;e<a.length;e++){let t=Math.floor((a[e].getTime()-a[e-1].getTime())/864e5);1===t?(s++,r=Math.max(r,s)):s=1}return Math.max(e,r)},0),h=null,u=0;r.forEach(e=>{let t=(null==d?void 0:d.filter(t=>t.entry_id===e.id))||[],a=C(e.period,new Date(e.createdat)),s=t.length/a;s>u&&(u=s,h={name:e.title,rate:s})}),console.log("Setting habit stats:",{activeHabits:c,completionRate:g,longestStreak:m,totalCompletions:x,mostConsistentHabit:h}),p({activeHabits:c,completionRate:g,longestStreak:m,totalCompletions:x,mostConsistentHabit:h})}catch(e){console.error("Error loading habit stats:",e)}},D=async()=>{try{if(!e){console.log("No user found, skipping activity data load");return}console.log("Loading activity data for user:",e.id);let t=new Date,a=(0,o.k)(t,364);console.log("Date range:",{startDate:a.toISOString(),endDate:t.toISOString()});let{data:s,error:r}=await i.O.from("activitytracker").select("date, count").eq("user_id",e.id).gte("date",a.toISOString()).lte("date",t.toISOString());if(r)throw console.error("Activity query error:",r),r;console.log("Raw activity counts:",s);let l=(function(e,t){let{start:a,end:s}=function(e,t){let[a,s]=(0,c.d)(e,t.start,t.end);return{start:a,end:s}}(t?.in,e),r=+a>+s,l=r?+a:+s,n=r?s:a;n.setHours(0,0,0,0);let i=t?.step??1;if(!i)return[];i<0&&(i=-i,r=!r);let d=[];for(;+n<=l;)d.push((0,x.L)(a,n)),n.setDate(n.getDate()+i),n.setHours(0,0,0,0);return r?d.reverse():d})({start:a,end:t}).map(e=>{let t=(0,d.WU)(e,"yyyy-MM-dd"),a=null==s?void 0:s.find(e=>{let a=(0,d.WU)(new Date(e.date),"yyyy-MM-dd")===t;return console.log("Matching day:",{activityDate:(0,d.WU)(new Date(e.date),"yyyy-MM-dd"),currentDate:t,matches:a,count:e.count}),a}),r={date:e,count:(null==a?void 0:a.count)||0};return a&&a.count>0&&console.log("Found activity for date:",{date:t,count:a.count}),r}),n=l.filter(e=>e.count>0);console.log("Activity summary:",{totalDays:l.length,activeDays:n.length,sampleActiveDays:n.slice(0,5).map(e=>({date:(0,d.WU)(e.date,"yyyy-MM-dd"),count:e.count}))}),j(l)}catch(e){console.error("Error loading activity data:",e),e instanceof Error&&console.error("Error details:",e.message)}},S=async()=>{let{data:t,error:a}=await i.O.from("tags").select("name, colorbg, colorfont").eq("user_id",e.id);if(a){console.error("Error loading tag colors:",a);return}k(t.reduce((e,t)=>(e[t.name]=t,e),{}))};function T(e){return 0===e?"bg-gray-100 dark:bg-gray-800":1===e?"bg-green-100 dark:bg-green-900":e<=3?"bg-green-300 dark:bg-green-700":e<=5?"bg-green-500 dark:bg-green-500":"bg-green-700 dark:bg-green-300"}function C(e,t){let a=new Date;switch(e){case"daily":return Math.max(1,Math.floor((a.getTime()-t.getTime())/864e5));case"weekly":return Math.max(1,Math.ceil((a.getTime()-t.getTime())/6048e5));case"monthly":return Math.max(1,a.getMonth()-t.getMonth()+12*(a.getFullYear()-t.getFullYear()));default:return 1}}return t?(0,s.jsx)("div",{className:"flex items-center justify-center min-h-screen",children:(0,s.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-brand-blue"})}):(0,s.jsxs)("div",{className:"space-y-4 sm:space-y-6 p-4 sm:p-6",children:[(0,s.jsx)("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4 sm:gap-0 mb-4 sm:mb-8",children:(0,s.jsxs)("div",{children:[(0,s.jsx)("h1",{className:"text-2xl sm:text-3xl font-bold text-gray-900 dark:text-white",children:"Dashboard"}),(0,s.jsx)("p",{className:"text-sm sm:text-base text-gray-600 dark:text-gray-400",children:"Track your progress"})]})}),(0,s.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 sm:gap-6",children:[(0,s.jsxs)("div",{className:"bg-white/90 dark:bg-gray-900/90 backdrop-blur-sm rounded-lg p-4 sm:p-6 shadow-xl border border-gray-200 dark:border-gray-800",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,s.jsx)("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"Habit Breakdown"}),(0,s.jsx)("span",{className:"text-lg",children:"\uD83D\uDCCA"})]}),(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)("div",{className:"text-3xl font-bold text-gray-900 dark:text-white",children:f.total}),(0,s.jsx)("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Total Habits"})]}),(0,s.jsxs)("div",{className:"grid grid-cols-3 gap-2",children:[(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)("div",{className:"text-xl font-semibold text-gray-900 dark:text-white",children:f.daily}),(0,s.jsx)("p",{className:"text-xs text-gray-600 dark:text-gray-400",children:"Daily"})]}),(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)("div",{className:"text-xl font-semibold text-gray-900 dark:text-white",children:f.weekly}),(0,s.jsx)("p",{className:"text-xs text-gray-600 dark:text-gray-400",children:"Weekly"})]}),(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)("div",{className:"text-xl font-semibold text-gray-900 dark:text-white",children:f.monthly}),(0,s.jsx)("p",{className:"text-xs text-gray-600 dark:text-gray-400",children:"Monthly"})]})]}),f.topTags.length>0&&(0,s.jsxs)("div",{className:"pt-2",children:[(0,s.jsx)("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-2",children:"Top Tags"}),(0,s.jsx)("div",{className:"flex flex-wrap gap-2",children:f.topTags.map(e=>(0,s.jsx)("span",{className:"px-2 py-1 rounded-full text-xs ".concat(function(e){let t=N[e];return t?"bg-[".concat(t.colorbg,"] text-[").concat(t.colorfont,"]"):"bg-gray-500/20 text-gray-300"}(e)),children:e},e))})]})]})]}),(0,s.jsxs)("div",{className:"bg-white/90 dark:bg-gray-900/90 backdrop-blur-sm rounded-lg p-4 sm:p-6 shadow-xl border border-gray-200 dark:border-gray-800",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,s.jsx)("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"Journal Entries"}),(0,s.jsx)("span",{className:"text-lg",children:"\uD83D\uDCDD"})]}),(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)("div",{className:"text-3xl font-bold text-gray-900 dark:text-white",children:h.totalEntries}),(0,s.jsx)("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Total Entries"})]}),(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)("div",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:h.totalWords.toLocaleString()}),(0,s.jsx)("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Words Written"})]}),(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsxs)("div",{className:"flex-1",children:[(0,s.jsxs)("div",{className:"text-xl font-semibold text-gray-900 dark:text-white flex items-center gap-2",children:[h.currentStreak," ",(0,s.jsx)("span",{className:"text-sm",children:"days \uD83D\uDD25"})]}),(0,s.jsx)("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Current Streak"})]}),(0,s.jsxs)("div",{className:"flex-1",children:[(0,s.jsxs)("div",{className:"text-xl font-semibold text-gray-900 dark:text-white flex items-center gap-2",children:[h.longestStreak," ",(0,s.jsx)("span",{className:"text-sm",children:"days \uD83C\uDFC6"})]}),(0,s.jsx)("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Longest Streak"})]})]})]})]}),(0,s.jsxs)("div",{className:"bg-white/90 dark:bg-gray-900/90 backdrop-blur-sm rounded-lg p-4 sm:p-6 shadow-xl border border-gray-200 dark:border-gray-800",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,s.jsx)("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"Habits"}),(0,s.jsx)("span",{className:"text-lg",children:"✅"})]}),(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)("div",{className:"text-3xl font-bold text-gray-900 dark:text-white",children:y.activeHabits}),(0,s.jsx)("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Active Habits"})]}),(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsxs)("div",{className:"text-3xl font-bold text-gray-900 dark:text-white",children:[Math.round(y.completionRate),"%"]}),(0,s.jsx)("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Completion Rate"})]})]}),(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)("div",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:y.totalCompletions.toLocaleString()}),(0,s.jsx)("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Total Completions"})]}),(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsxs)("div",{className:"flex-1",children:[(0,s.jsxs)("div",{className:"text-xl font-semibold text-gray-900 dark:text-white flex items-center gap-2",children:[y.longestStreak," ",(0,s.jsx)("span",{className:"text-sm",children:"days \uD83D\uDD25"})]}),(0,s.jsx)("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Longest Streak"})]}),(0,s.jsx)("div",{className:"flex-1",children:y.mostConsistentHabit&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("div",{className:"text-base font-semibold text-gray-900 dark:text-white truncate",title:y.mostConsistentHabit.name,children:y.mostConsistentHabit.name}),(0,s.jsx)("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Most Consistent"})]})})]})]})]})]}),(0,s.jsxs)("div",{className:"bg-white/90 dark:bg-gray-900/90 backdrop-blur-sm rounded-lg p-4 sm:p-6 shadow-xl border border-gray-200 dark:border-gray-800",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,s.jsx)("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"Activity Tracker"}),(0,s.jsx)("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Last year"})]}),(0,s.jsx)("div",{className:"overflow-x-auto",children:(0,s.jsxs)("div",{className:"relative",style:{maxWidth:"900px"},children:[(0,s.jsx)("div",{className:"flex text-xs text-gray-600 dark:text-gray-400 mb-2 pl-8",children:Array.from({length:12}).map((e,t)=>{let a=new Date;return a.setDate(1),a.setMonth(a.getMonth()-11+t),(0,s.jsx)("div",{className:"flex-1",children:(0,d.WU)(a,"MMM")},t)})}),(0,s.jsxs)("div",{className:"flex",children:[(0,s.jsxs)("div",{className:"flex flex-col text-xs text-gray-600 dark:text-gray-400 pr-2",style:{height:"112px",paddingTop:"0px"},children:[(0,s.jsx)("div",{style:{height:"12px",marginTop:"0px"},children:"Sun"}),(0,s.jsx)("div",{style:{height:"12px",marginTop:"16px"},children:"Tue"}),(0,s.jsx)("div",{style:{height:"12px",marginTop:"16px"},children:"Thu"}),(0,s.jsx)("div",{style:{height:"12px",marginTop:"16px"},children:"Sat"})]}),(0,s.jsx)("div",{className:"flex gap-[2px]",style:{width:"100%"},children:(()=>{let e=new Date,t=(0,o.k)(e,364),a=[],r=(0,g.z)(t);for(;r<=e;){let t=[];for(let a=0;a<7;a++){let a=new Date(r);if(a<=e){let e=v.find(e=>e.date&&function(e,t,a){let[s,r]=(0,c.d)(void 0,e,t);return+(0,m.b)(s)==+(0,m.b)(r)}(new Date(e.date),a));t.push({date:a,count:(null==e?void 0:e.count)||0})}else t.push(null);r.setDate(r.getDate()+1)}a.push(t)}return a.map((e,t)=>(0,s.jsx)("div",{className:"flex-1 flex flex-col gap-[2px] min-w-[10px]",children:e.map((e,t)=>(0,s.jsx)("div",{className:"w-full aspect-square rounded-[1px] ".concat(e?T(e.count):"bg-transparent"),title:e?"".concat((0,d.WU)(e.date,"MMM d, yyyy"),": ").concat(e.count," activities"):""},t))},t))})()})]}),(0,s.jsxs)("div",{className:"mt-4 flex items-center justify-end gap-2 text-xs",children:[(0,s.jsx)("span",{className:"text-gray-600 dark:text-gray-400",children:"Less"}),(0,s.jsx)("div",{className:"flex gap-[2px]",children:[0,2,4,6,8].map(e=>(0,s.jsx)("div",{className:"w-[10px] h-[10px] rounded-[1px] ".concat(T(e))},e))}),(0,s.jsx)("span",{className:"text-gray-600 dark:text-gray-400",children:"More"})]})]})})]})]})}},18628:function(e,t,a){"use strict";a.r(t),a.d(t,{AuthProvider:function(){return i},useAuth:function(){return d}});var s=a(57437),r=a(2265),l=a(14958);let n=(0,r.createContext)({user:null,loading:!0,signOut:async()=>{}});function i(e){let{children:t}=e,[a,i]=(0,r.useState)(null),[d,o]=(0,r.useState)(!0),c=async()=>{let{error:e}=await l.O.auth.signOut();if(e)throw console.error("Error signing out:",e),e};return(0,r.useEffect)(()=>{l.O.auth.getSession().then(e=>{var t;let{data:{session:a}}=e;i(null!==(t=null==a?void 0:a.user)&&void 0!==t?t:null),o(!1)});let{data:{subscription:e}}=l.O.auth.onAuthStateChange((e,t)=>{var a;i(null!==(a=null==t?void 0:t.user)&&void 0!==a?a:null),o(!1)});return()=>e.unsubscribe()},[]),(0,s.jsx)(n.Provider,{value:{user:a,loading:d,signOut:c},children:t})}let d=()=>(0,r.useContext)(n)},14958:function(e,t,a){"use strict";a.d(t,{O:function(){return i}});var s=a(54566);let r="https://dkvaspqbakjcwaxivtqo.supabase.co",l="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImRrdmFzcHFiYWtqY3dheGl2dHFvIiwicm9sZSI6ImFub24iLCJpYXQiOjE3MzcxMjk4NzcsImV4cCI6MjA1MjcwNTg3N30.dcVtOCJWN17M9K5MFMk6cRNugze9Dw-JnlTniPrFONI\n";if(!r||!l)throw Error("Missing Supabase environment variables");let n=r.trim(),i=(0,s.eI)(n,l,{auth:{persistSession:!0,autoRefreshToken:!0},db:{schema:"public"}})}},function(e){e.O(0,[382,1082,2971,4938,1744],function(){return e(e.s=14145)}),_N_E=e.O()}]);