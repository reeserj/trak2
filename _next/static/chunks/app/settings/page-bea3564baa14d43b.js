(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6938],{18427:function(e,t,r){Promise.resolve().then(r.bind(r,1077))},1077:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return c}});var a=r(57437),n=r(2265),i=r(91389),l=r(18628),s=r(14958),o=r(56926);function c(){let{isCollapsed:e}=(0,i.useSidebar)(),{user:t,signOut:r}=(0,l.useAuth)(),{address:c}=(0,o.mA)(),[d,u]=(0,n.useState)(""),[m,h]=(0,n.useState)(!1),[p,b]=(0,n.useState)(!1),[f,x]=(0,n.useState)(!1),[g,v]=(0,n.useState)({weeklySummary:!1,achievements:!1});(0,n.useEffect)(()=>{(async()=>{if(!(null==t?void 0:t.id))return;let{data:e,error:r}=await s.O.from("User").select("name, wallet_address").eq("id",t.id).single();if(e)c&&e.wallet_address!==c&&await s.O.from("User").update({wallet_address:c}).eq("id",t.id),u(e.name||"");else{let e="";t.email?e=t.email.split("@")[0]:c&&(e="".concat(c.slice(0,6),"...").concat(c.slice(-4)));let{data:r,error:a}=await s.O.from("User").insert([{id:t.id,email:t.email,wallet_address:c,name:e}]).select().single();r&&u(r.name)}})()},[null==t?void 0:t.id,null==t?void 0:t.email,c]);let y=async()=>{if(null==t?void 0:t.id){h(!0);try{let{error:e}=await s.O.from("User").update({name:d,wallet_address:c}).eq("id",t.id);if(e)throw e;console.log("Settings updated successfully")}catch(e){console.error("Error updating settings:",e)}finally{h(!1)}}},w=async()=>{if(null==t?void 0:t.id){if(!f){x(!0);return}b(!0);try{let{error:e}=await s.O.from("User").delete().eq("id",t.id);if(e)throw e;await r(),window.location.href="/"}catch(e){console.error("Error deleting account:",e),alert("Failed to delete account. Please try again.")}finally{b(!1),x(!1)}}},j=async()=>{if(!(null==t?void 0:t.id)){console.error("No user ID found"),alert("Please log in to export your data");return}try{console.log("Starting data export for user:",t.id);let{data:e,error:r}=await s.O.from("entries").select("id, title, content, type, frequency, created_at").eq("user_id",t.id);if(r)throw console.error("Error fetching entries:",r),r;console.log("Successfully fetched entries:",(null==e?void 0:e.length)||0);let a=(null==e?void 0:e.filter(e=>"habit"===e.type))||[],n=(null==e?void 0:e.filter(e=>"journal"===e.type))||[];if(a&&a.length>0){let e=a.map(e=>[e.id,'"'.concat((e.title||"").replace(/"/g,'""'),'"'),'"'.concat((e.content||"").replace(/"/g,'""'),'"'),e.frequency,e.created_at].join(",")),t=["ID,Title,Content,Frequency,Created At",...e].join("\n"),r=new Blob([t],{type:"text/csv"}),n=window.URL.createObjectURL(r),i=document.createElement("a");i.href=n,i.download="habits-export-".concat(new Date().toISOString().split("T")[0],".csv"),document.body.appendChild(i),i.click(),window.URL.revokeObjectURL(n),document.body.removeChild(i)}if(n&&n.length>0){let e=n.map(e=>[e.id,'"'.concat((e.title||"").replace(/"/g,'""'),'"'),'"'.concat((e.content||"").replace(/"/g,'""'),'"'),e.created_at].join(",")),t=["ID,Title,Content,Created At",...e].join("\n"),r=new Blob([t],{type:"text/csv"}),a=window.URL.createObjectURL(r),i=document.createElement("a");i.href=a,i.download="journals-export-".concat(new Date().toISOString().split("T")[0],".csv"),document.body.appendChild(i),i.click(),window.URL.revokeObjectURL(a),document.body.removeChild(i)}alert("Your data has been exported successfully!")}catch(e){console.error("Error exporting data:",e),alert("Failed to export data. Please check the console for more details.")}},N=e=>{v(t=>({...t,[e]:!t[e]}))};return(0,a.jsx)("div",{className:"".concat(e?"ml-20":"ml-[20px]"," transition-all duration-300"),children:(0,a.jsx)("div",{className:"p-6",children:(0,a.jsxs)("div",{className:"max-w-4xl space-y-8",children:[(0,a.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,a.jsx)("h1",{className:"text-3xl font-bold",children:"Settings"}),(0,a.jsx)("p",{className:"text-muted-foreground",children:"Manage your account settings and preferences."})]}),(0,a.jsxs)("div",{className:"grid gap-6",children:[(0,a.jsxs)("section",{className:"bg-background rounded-lg border shadow-sm p-6",children:[(0,a.jsx)("h2",{className:"text-2xl font-semibold mb-4",children:"Account Settings"}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium mb-1",children:"Name"}),(0,a.jsx)("input",{type:"text",className:"w-full px-3 py-2 bg-background border rounded-md",placeholder:"Your name",value:d,onChange:e=>u(e.target.value)})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium mb-1",children:"Email"}),(0,a.jsx)("input",{type:"email",className:"w-full px-3 py-2 bg-background border rounded-md",placeholder:"Your email",value:(null==t?void 0:t.email)||"",disabled:!0})]}),(0,a.jsxs)("div",{className:"flex justify-between pt-4",children:[(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)("button",{className:"px-4 py-2 text-white rounded-md transition-colors disabled:opacity-50 ".concat(f?"bg-red-600 hover:bg-red-700":"bg-red-500 hover:bg-red-600"),onClick:w,disabled:p,children:p?"Deleting...":f?"Are you sure? Click again if you are":"Delete Account"}),f&&(0,a.jsx)("button",{className:"px-4 py-2 bg-gray-500 hover:bg-gray-600 text-white rounded-md transition-colors",onClick:()=>x(!1),children:"Nevermind"})]}),(0,a.jsx)("button",{className:"px-4 py-2 bg-primary hover:bg-primary/90 text-primary-foreground rounded-md transition-colors disabled:opacity-50",onClick:y,disabled:m,children:m?"Saving...":"Save Changes"})]})]})]}),(0,a.jsxs)("section",{className:"bg-background rounded-lg border shadow-sm p-6",children:[(0,a.jsx)("h2",{className:"text-2xl font-semibold mb-4",children:"Privacy & Security"}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsx)("button",{className:"px-4 py-2 border hover:bg-accent rounded-md transition-colors",onClick:j,children:"Export Your Data"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium mb-1",children:"Email Notifications"}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsxs)("label",{className:"flex items-center gap-2",children:[(0,a.jsx)("input",{type:"checkbox",className:"rounded border-gray-300",checked:g.weeklySummary,onChange:()=>N("weeklySummary")}),(0,a.jsx)("span",{children:"Receive weekly summaries"})]}),(0,a.jsxs)("label",{className:"flex items-center gap-2",children:[(0,a.jsx)("input",{type:"checkbox",className:"rounded border-gray-300",checked:g.achievements,onChange:()=>N("achievements")}),(0,a.jsx)("span",{children:"Receive achievement notifications"})]})]})]})]})]})]})]})})})}},18628:function(e,t,r){"use strict";r.r(t),r.d(t,{AuthProvider:function(){return s},useAuth:function(){return o}});var a=r(57437),n=r(2265),i=r(14958);let l=(0,n.createContext)({user:null,loading:!0,signOut:async()=>{}});function s(e){let{children:t}=e,[r,s]=(0,n.useState)(null),[o,c]=(0,n.useState)(!0),d=async()=>{let{error:e}=await i.O.auth.signOut();if(e)throw console.error("Error signing out:",e),e};return(0,n.useEffect)(()=>{i.O.auth.getSession().then(e=>{var t;let{data:{session:r}}=e;s(null!==(t=null==r?void 0:r.user)&&void 0!==t?t:null),c(!1)});let{data:{subscription:e}}=i.O.auth.onAuthStateChange((e,t)=>{var r;s(null!==(r=null==t?void 0:t.user)&&void 0!==r?r:null),c(!1)});return()=>e.unsubscribe()},[]),(0,a.jsx)(l.Provider,{value:{user:r,loading:o,signOut:d},children:t})}let o=()=>(0,n.useContext)(l)},91389:function(e,t,r){"use strict";r.r(t),r.d(t,{SidebarProvider:function(){return l},useSidebar:function(){return s}});var a=r(57437),n=r(2265);let i=(0,n.createContext)(void 0);function l(e){let{children:t}=e,[r,l]=(0,n.useState)(!1);return(0,a.jsx)(i.Provider,{value:{isCollapsed:r,setIsCollapsed:l},children:t})}function s(){let e=(0,n.useContext)(i);if(void 0===e)throw Error("useSidebar must be used within a SidebarProvider");return e}},14958:function(e,t,r){"use strict";r.d(t,{O:function(){return s}});var a=r(54566);let n="https://dkvaspqbakjcwaxivtqo.supabase.co",i="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImRrdmFzcHFiYWtqY3dheGl2dHFvIiwicm9sZSI6ImFub24iLCJpYXQiOjE3MzcxMjk4NzcsImV4cCI6MjA1MjcwNTg3N30.dcVtOCJWN17M9K5MFMk6cRNugze9Dw-JnlTniPrFONI\n";if(!n||!i)throw Error("Missing Supabase environment variables");let l=n.trim(),s=(0,a.eI)(l,i,{auth:{persistSession:!0,autoRefreshToken:!0},db:{schema:"public"}})}},function(e){e.O(0,[382,6926,2971,4938,1744],function(){return e(e.s=18427)}),_N_E=e.O()}]);