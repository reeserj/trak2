(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4020],{24172:function(e,t,r){Promise.resolve().then(r.bind(r,70695))},70695:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return d}});var a=r(57437),n=r(18628),i=r(24033),s=r(2265),l=r(14958),o=r(91389);function d(){var e,t,r;let{user:d,loading:c}=(0,n.useAuth)(),u=(0,i.useRouter)(),{isCollapsed:m}=(0,o.useSidebar)(),[g,h]=(0,s.useState)(!1),[p,b]=(0,s.useState)(!1),[x,f]=(0,s.useState)(!1),[y,v]=(0,s.useState)(null),[w,j]=(0,s.useState)([]),[N,k]=(0,s.useState)(null),[S,D]=(0,s.useState)([]),[_,O]=(0,s.useState)({name:"",description:"",period:"daily",reminder:{enabled:!1,frequency:"daily",time:"",type:"habit"},tags:[]}),[C,q]=(0,s.useState)(""),[E,I]=(0,s.useState)(""),[M,J]=(0,s.useState)([]),[T,H]=(0,s.useState)({total:0,active:0,completed:0}),F=async()=>{if(!d)return;console.log("Loading habits for user:",d.id);let{data:e,error:t}=await l.O.from("entries").select("*").eq("user_id",d.id).eq("type","habit").order("createdat",{ascending:!1});if(t){console.error("Error loading habits:",t);return}console.log("Fetched habits:",e);let r=(null==e?void 0:e.map(e=>{try{if("string"==typeof e.content&&!e.content.startsWith("{")){let t={...e,content:JSON.stringify({description:e.content,frequency:e.period})};return l.O.from("entries").update({content:t.content}).eq("id",e.id).then(e=>{let{error:t}=e;t&&console.error("Error updating habit content:",t)}),t}return JSON.parse(e.content),e}catch(r){let t=JSON.stringify({description:e.content||"",frequency:e.period});return l.O.from("entries").update({content:t}).eq("id",e.id).then(e=>{let{error:t}=e;t&&console.error("Error updating habit content:",t)}),{...e,content:t}}}))||[];if(r.length>0){let e=r.map(e=>e.id);console.log("Habit IDs:",e);let{data:t,error:a}=await l.O.from("tags").select("*").in("entry_id",e);if(a){console.error("Error loading tags:",a);return}let n=r.map(async e=>{let{data:t}=await l.O.from("entries").select("*").eq("user_id",d.id).eq("type","habit_completion").order("createdat",{ascending:!1}),r=(null==t?void 0:t.filter(t=>{try{return JSON.parse(t.content).completed_habit_id===e.id}catch(e){return!1}}).map(e=>new Date(e.createdat)).sort((e,t)=>t.getTime()-e.getTime()))||[],a=0;for(let t=0;t<r.length;t++){let n=r[t];if(0===t){let t=L(e.period),r=Y(e.period);if(n>=t&&n<=r)a=1;else break}else{let i=r[t-1];if(P(e.period,n,i))a++;else break}}return{habitId:e.id,currentStreak:a,completions:r}}),i=await Promise.all(n),s=r.map(e=>{let r=(null==t?void 0:t.filter(t=>t.entry_id===e.id))||[],a=i.find(t=>t.habitId===e.id),n=L(e.period),s=Y(e.period);return{...e,tags:r,completed:(null==a?void 0:a.completions.some(e=>e>=n&&e<=s))||!1,currentStreak:(null==a?void 0:a.currentStreak)||0}});console.log("Setting habits:",s),j(s)}else console.log("No habits found"),j([])},P=(e,t,r)=>{switch(e){case"daily":return 1===Math.floor((r.getTime()-t.getTime())/864e5);case"weekly":let a=new Date(t),n=new Date(r);for(;0!==a.getDay();)a.setDate(a.getDate()-1);for(;0!==n.getDay();)n.setDate(n.getDate()-1);return 1==(n.getTime()-a.getTime())/6048e5;case"monthly":return t.getMonth()===(r.getMonth()+1)%12&&(0===t.getMonth()?t.getFullYear()===r.getFullYear()+1:t.getFullYear()===r.getFullYear());default:return!1}};if((0,s.useEffect)(()=>{if(!c&&!d){u.push("/");return}d&&(async()=>{try{console.log("Starting to load data..."),await F(),await et(),await V(),console.log("All data loaded successfully")}catch(e){console.error("Error loading data:",e)}})()},[d,c,u]),(0,s.useEffect)(()=>{c||d||u.push("/")},[d,c,u]),c)return(0,a.jsx)("div",{className:"flex items-center justify-center min-h-screen",children:(0,a.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-brand-blue"})});let z=(e,t)=>{if(0===e)return"";switch(t){case"daily":return"".concat(e," day").concat(e>1?"s":""," streak");case"weekly":return"".concat(e," week").concat(e>1?"s":""," streak");case"monthly":return"".concat(e," month").concat(e>1?"s":""," streak");default:return""}},A=async()=>{if(!d){console.log("No user, skipping activity load");return}let e=new Date;e.setDate(e.getDate()-30),console.log("Loading activities since:",e);try{let{data:t,error:r}=await l.O.from("entries").select("*").eq("user_id",d.id).eq("type","habit").gte("createdat",e.toISOString()).order("createdat",{ascending:!1});if(r){console.error("Error fetching habits:",r);return}console.log("Fetched habit entries:",t);let{data:a,error:n}=await l.O.from("entries").select("*").eq("user_id",d.id).eq("type","habit_completion").gte("createdat",e.toISOString()).order("createdat",{ascending:!1});if(n){console.error("Error fetching completions:",n);return}console.log("Fetched completion entries:",a);let i=[];for(let e of t||[]){console.log("Processing habit entry:",e);let t={id:e.id,title:e.title,content:e.content,type:"habit",period:e.period,user_id:e.user_id,createdat:e.createdat,updatedat:e.updatedat,tags:e.tags||[]};i.push({habit:t,date:new Date(e.createdat),type:"created"}),e.updatedat!==e.createdat&&i.push({habit:t,date:new Date(e.updatedat),type:"updated"})}for(let e of a||[])try{let r=JSON.parse(e.content).completed_habit_id;console.log("Processing completion for habit:",r);let n=null==t?void 0:t.find(e=>e.id===r);if(n){console.log("Found matching habit:",n.title);let t={id:n.id,title:n.title,content:n.content,type:"habit",period:n.period,user_id:n.user_id,createdat:n.createdat,updatedat:n.updatedat,tags:n.tags||[]},s=a.filter(e=>{try{return JSON.parse(e.content).completed_habit_id===r}catch(e){return!1}}).length;console.log("Adding completion with streak:",s),i.push({habit:t,date:new Date(e.createdat),type:"completed",streakCount:s>1?s:void 0})}else console.log("No matching habit found for completion")}catch(e){console.error("Error processing completion:",e)}N&&(console.log("Filtering by tag:",N),i=i.filter(e=>{var t;return null===(t=e.habit.tags)||void 0===t?void 0:t.some(e=>e.name===N)})),i.sort((e,t)=>t.date.getTime()-e.date.getTime()),console.log("Setting activities:",i),J(i)}catch(e){console.error("Error loading activity data:",e)}};(0,s.useEffect)(()=>{d&&w.length>0&&A().catch(console.error)},[d,N,w]);let R=async e=>{if(!d)return;let t=!!e.completed;try{let r=new Date;if(j(r=>r.map(r=>{if(r.id===e.id){let e=r.currentStreak||0;return{...r,completed:!t,currentStreak:t?e-1:e+1}}return r})),t){let{data:r}=await l.O.from("entries").select("*").eq("user_id",d.id).eq("type","habit_completion").gte("createdat",L(e.period).toISOString()).lte("createdat",Y(e.period).toISOString()),a=null==r?void 0:r.find(t=>{try{return JSON.parse(t.content).completed_habit_id===e.id}catch(e){return!1}});if(a){let{error:r}=await l.O.from("entries").delete().eq("id",a.id);if(r){console.error("Error deleting completion:",r),j(r=>r.map(r=>{if(r.id===e.id){let e=r.currentStreak||0;return{...r,completed:t,currentStreak:e+1}}return r}));return}}}else{let a=crypto.randomUUID(),{error:n}=await l.O.from("entries").insert([{id:a,user_id:d.id,title:"".concat(e.title," Completion"),content:JSON.stringify({completed_habit_id:e.id,completed_at:r.toISOString()}),type:"habit_completion",createdat:r.toISOString(),updatedat:r.toISOString()}]);if(n){console.error("Error adding completion:",n),j(r=>r.map(r=>{if(r.id===e.id){let e=r.currentStreak||0;return{...r,completed:t,currentStreak:e-1}}return r}));return}}await A()}catch(r){console.error("Error toggling habit completion:",r),j(r=>r.map(r=>r.id===e.id?{...r,completed:t,currentStreak:t?(r.currentStreak||0)+1:(r.currentStreak||0)-1}:r))}},L=e=>{let t=new Date(new Date);switch(e){case"daily":return t.setHours(0,0,0,0),t;case"weekly":for(;0!==t.getDay();)t.setDate(t.getDate()-1);return t.setHours(0,0,0,0),t;case"monthly":return t.setDate(1),t.setHours(0,0,0,0),t;default:return t}},Y=e=>{let t=new Date(new Date);switch(e){case"daily":return t.setHours(23,59,59,999),t;case"weekly":for(;6!==t.getDay();)t.setDate(t.getDate()+1);return t.setHours(23,59,59,999),t;case"monthly":return t.setMonth(t.getMonth()+1),t.setDate(0),t.setHours(23,59,59,999),t;default:return t}},W=e=>{try{return JSON.parse(e).description||""}catch(t){return e}},U=e=>{var t,r;return(0,a.jsxs)("div",{className:"flex flex-col p-3 bg-gray-800/60 rounded-lg hover:bg-gray-800/80 transition-colors cursor-pointer",onClick:()=>Z(e),children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)("button",{type:"button",onClick:t=>{t.preventDefault(),t.stopPropagation(),R(e)},className:"w-5 h-5 rounded border ".concat(e.completed?"bg-brand-blue border-brand-blue text-white":"border-gray-500 hover:border-brand-blue"," flex items-center justify-center transition-colors focus:outline-none focus:ring-2 focus:ring-brand-blue"),"aria-label":e.completed?"Mark as incomplete":"Mark as complete",children:e.completed&&(0,a.jsx)("svg",{className:"w-3 h-3",viewBox:"0 0 12 12",fill:"none",children:(0,a.jsx)("path",{d:"M2 6L5 9L10 3",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"flex items-center gap-2",children:(0,a.jsx)("h4",{className:"font-medium text-white ".concat(e.completed?"line-through opacity-70":""),children:e.title})}),(0,a.jsx)("p",{className:"text-sm text-gray-300 ".concat(e.completed?"line-through opacity-70":""),children:W(e.content)})]})]}),(0,a.jsx)("button",{className:"p-2 hover:bg-gray-700/60 rounded-lg text-gray-300",onClick:t=>{t.stopPropagation(),Z(e)},children:"⋮"})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[e.tags&&e.tags.length>0&&(0,a.jsx)("div",{className:"flex flex-wrap gap-1",children:e.tags.map(e=>(0,a.jsx)("button",{onClick:t=>{t.stopPropagation(),B(e.name)},className:"inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium ".concat(X(e.name)," ").concat(N===e.name?"ring-2 ring-white":""," hover:ring-2 hover:ring-white/50 transition-all cursor-pointer"),children:e.name},e.id))}),(null!==(t=e.currentStreak)&&void 0!==t?t:0)>0&&(0,a.jsx)("div",{className:"flex items-center",children:(0,a.jsxs)("span",{className:"text-xs px-2 py-0.5 bg-brand-blue/20 text-brand-blue rounded-full",children:[z(null!==(r=e.currentStreak)&&void 0!==r?r:0,e.period)," \uD83D\uDD25"]})})]})]},e.id)},B=e=>{k(N===e?null:e)},K=e=>{let t=w.filter(t=>t.period===e);return N&&(t=t.filter(e=>{var t;return null===(t=e.tags)||void 0===t?void 0:t.some(e=>e.name===N)})),t},G=e=>{if(y){var t;v({...y,tags:(null===(t=y.tags)||void 0===t?void 0:t.filter(t=>t.id!==e.id))||[]})}},V=async()=>{if(!d)return;let{data:e,error:t}=await l.O.from("tags").select("*").eq("user_id",d.id).order("createdat",{ascending:!1});if(t){console.error("Error loading tags:",t);return}D(Array.from(new Set(e.map(e=>e.name))).slice(0,5).map(t=>e.find(e=>e.name===t)))},X=e=>{let t=["bg-blue-500/20 text-blue-400","bg-purple-500/20 text-purple-400","bg-green-500/20 text-green-400","bg-pink-500/20 text-pink-400","bg-yellow-500/20 text-yellow-400","bg-indigo-500/20 text-indigo-400"];return t[e.split("").reduce((e,t)=>e+t.charCodeAt(0),0)%t.length]},Z=e=>{let t=W(e.content);v({...e,content:t}),b(!0)},Q=async e=>{if(e.preventDefault(),d&&y)try{let{error:e}=await l.O.from("entries").update({title:y.title,content:JSON.stringify({description:y.content,frequency:y.period}),period:y.period,updatedat:new Date().toISOString()}).eq("id",y.id).eq("type","habit");if(e)throw e;if(y.tags&&(await l.O.from("tags").delete().eq("entry_id",y.id),y.tags.length>0)){let{error:e}=await l.O.from("tags").insert(y.tags.map(e=>({name:e.name,entry_id:y.id,user_id:d.id,createdat:new Date().toISOString()})));if(e)throw e}if(y.reminder){if(y.reminder.id){let{error:e}=await l.O.from("reminders").update({frequency:y.reminder.frequency,time:y.reminder.time,type:"habit"}).eq("id",y.reminder.id);if(e)throw e}else if(y.reminder.enabled&&y.reminder.time){let{error:e}=await l.O.from("reminders").insert([{entry_id:y.id,frequency:y.reminder.frequency,time:y.reminder.time,type:"habit",createdat:new Date().toISOString()}]);if(e)throw e}}j(e=>e.map(e=>e.id===y.id?{...y,content:JSON.stringify({description:y.content,frequency:y.period})}:e)),b(!1),v(null),await F(),await A()}catch(e){console.error("Error updating habit:",e)}},$=async e=>{if(d)try{let{error:t}=await l.O.from("tags").delete().eq("entry_id",e);if(t){console.error("Error deleting tags:",t);return}let{data:r,error:a}=await l.O.from("entries").select("id, content").eq("type","habit_completion");if(a){console.error("Error fetching completions:",a);return}let n=null==r?void 0:r.filter(t=>{try{return JSON.parse(t.content).completed_habit_id===e}catch(e){return!1}}).map(e=>e.id);if(n&&n.length>0){let{error:e}=await l.O.from("entries").delete().in("id",n);if(e){console.error("Error deleting completions:",e);return}}let{error:i}=await l.O.from("entries").delete().eq("id",e).eq("type","habit");if(i){console.error("Error deleting habit:",i);return}j(t=>t.filter(t=>t.id!==e)),b(!1),v(null),await A()}catch(e){console.error("Error deleting habit:",e)}},ee=e=>{let t=new Date,r=new Date(t);return(r.setDate(r.getDate()-1),e.toDateString()===t.toDateString())?"Today":e.toDateString()===r.toDateString()?"Yesterday":e.toLocaleDateString("en-US",{month:"short",day:"numeric"})},et=async()=>{if(d)try{let{data:e,error:t}=await l.O.from("entries").select("id").eq("user_id",d.id).eq("type","habit");if(t){console.error("Error loading habit stats:",t);return}let{data:r,error:a}=await l.O.from("entries").select("id").eq("user_id",d.id).eq("type","habit_completion");if(a){console.error("Error loading completion stats:",a);return}let n=new Date;n.setDate(n.getDate()-7);let{data:i,error:s}=await l.O.from("entries").select("id, content").eq("user_id",d.id).eq("type","habit_completion").gte("createdat",n.toISOString());if(s){console.error("Error loading active habits:",s);return}let o=new Set((i||[]).map(e=>{try{return JSON.parse(e.content).completed_habit_id}catch(e){return null}}).filter(Boolean));H({total:(null==e?void 0:e.length)||0,active:o.size,completed:(null==r?void 0:r.length)||0})}catch(e){console.error("Error loading habit stats:",e)}},er=e=>{O(t=>({...t,tags:t.tags.filter(t=>t!==e)}))},ea=async e=>{if(e.preventDefault(),d)try{let e=crypto.randomUUID(),{data:t,error:r}=await l.O.from("entries").insert([{id:e,title:_.name,content:JSON.stringify({description:_.description,frequency:_.period}),type:"habit",period:_.period,user_id:d.id,createdat:new Date().toISOString(),updatedat:new Date().toISOString()}]).select().single();if(r)throw r;if(_.tags.length>0){let{error:e}=await l.O.from("tags").insert(_.tags.map(e=>({name:e,entry_id:t.id,user_id:d.id,createdat:new Date().toISOString()})));if(e)throw e}if(_.reminder.enabled&&_.reminder.time){let{error:e}=await l.O.from("reminders").insert([{entry_id:t.id,frequency:_.reminder.frequency,type:"habit",time:_.reminder.time,createdat:new Date().toISOString()}]);if(e)throw e}O({name:"",description:"",period:"daily",reminder:{enabled:!1,frequency:"daily",time:"",type:"habit"},tags:[]}),h(!1),await F(),await A()}catch(e){console.error("Error creating habit:",e)}};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-white/50 via-blue-100/30 to-white/50 dark:from-gray-900/50 dark:via-gray-800/30 dark:to-black/50 animate-gradient-shift bg-[length:200%_200%] fixed inset-0 -z-10"}),(0,a.jsxs)("div",{className:"p-6",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center mb-8",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h1",{className:"text-3xl font-bold text-gray-900 dark:text-white",children:"My Habits"}),(0,a.jsx)("p",{className:"text-gray-600 dark:text-gray-400",children:"Track and manage your daily habits"})]}),(0,a.jsx)("button",{onClick:()=>h(!0),className:"px-4 py-2 bg-brand-blue text-white rounded-lg hover:bg-opacity-90 shadow-[0_0_15px_rgba(29,99,255,0.5)] hover:shadow-[0_0_20px_rgba(29,99,255,0.7)] transition-all duration-300",children:"+ New Habit"})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 mb-8",children:[(0,a.jsxs)("div",{className:"bg-gray-900/40 backdrop-blur-sm rounded-lg p-6",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-white mb-4",children:"Daily Habits"}),(0,a.jsxs)("div",{className:"space-y-4",children:[K("daily").map(e=>U(e)),0===K("daily").length&&(0,a.jsx)("p",{className:"text-gray-400 text-center py-4",children:N?'No daily habits with tag "'.concat(N,'"'):"No daily habits yet"})]})]}),(0,a.jsxs)("div",{className:"bg-gray-900/40 backdrop-blur-sm rounded-lg p-6",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-white mb-4",children:"Weekly Habits"}),(0,a.jsxs)("div",{className:"space-y-4",children:[K("weekly").map(e=>U(e)),0===K("weekly").length&&(0,a.jsx)("p",{className:"text-gray-400 text-center py-4",children:N?'No weekly habits with tag "'.concat(N,'"'):"No weekly habits yet"})]})]}),(0,a.jsxs)("div",{className:"bg-gray-900/40 backdrop-blur-sm rounded-lg p-6",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-white mb-4",children:"Monthly Goals"}),(0,a.jsxs)("div",{className:"space-y-4",children:[K("monthly").map(e=>U(e)),0===K("monthly").length&&(0,a.jsx)("p",{className:"text-gray-400 text-center py-4",children:N?'No monthly habits with tag "'.concat(N,'"'):"No monthly goals yet"})]})]})]}),(0,a.jsxs)("div",{className:"bg-gray-900/40 backdrop-blur-sm rounded-lg p-6",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-white mb-4",children:"Recent Activity"}),(0,a.jsx)("div",{className:"space-y-4",children:0===M.length?(0,a.jsx)("p",{className:"text-gray-400 text-center py-4",children:"No activity in the last 30 days"}):M.map((e,t)=>(0,a.jsxs)("div",{className:"flex items-center gap-4 text-sm",children:[(0,a.jsx)("div",{className:"w-24 text-gray-300",children:ee(e.date)}),(0,a.jsxs)("div",{className:"flex-1 bg-gray-800/60 p-3 rounded-lg",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2 text-white",children:["completed"===e.type?(0,a.jsx)("span",{className:"text-green-400",children:"✓"}):"created"===e.type?(0,a.jsx)("span",{className:"text-brand-blue",children:"+"}):(0,a.jsx)("span",{className:"text-yellow-400",children:"⟳"}),(0,a.jsx)("span",{children:"completed"===e.type?"Completed habit: ".concat(e.habit.title):"created"===e.type?"Created habit: ".concat(e.habit.title):"Updated habit: ".concat(e.habit.title)})]}),"completed"===e.type&&e.streakCount&&e.streakCount>1&&(0,a.jsxs)("span",{className:"text-xs px-2 py-0.5 bg-brand-blue/20 text-brand-blue rounded-full",children:[z(e.streakCount,e.habit.period)," \uD83D\uDD25"]})]}),e.habit.tags&&e.habit.tags.length>0&&(0,a.jsx)("div",{className:"flex flex-wrap gap-1 mt-2",children:e.habit.tags.map(e=>(0,a.jsx)("span",{className:"inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium ".concat(X(e.name)),children:e.name},e.id))})]})]},"".concat(e.habit.id,"-").concat(t)))})]})]}),g&&(0,a.jsx)("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50",children:(0,a.jsxs)("div",{className:"bg-gray-900/90 rounded-xl p-6 w-full max-w-md m-4 shadow-xl border border-gray-800",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,a.jsx)("h2",{className:"text-xl font-semibold text-white",children:"Create New Habit"}),(0,a.jsx)("button",{onClick:()=>h(!1),className:"text-gray-400 hover:text-white transition-colors",children:"✕"})]}),(0,a.jsxs)("form",{onSubmit:ea,className:"space-y-6",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Habit Name"}),(0,a.jsx)("input",{type:"text",value:_.name,onChange:e=>O({..._,name:e.target.value}),className:"w-full px-3 py-2 bg-gray-800 border border-gray-700 rounded-lg text-white focus:ring-2 focus:ring-brand-blue focus:border-transparent",placeholder:"e.g., Morning Meditation",required:!0})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Description"}),(0,a.jsx)("textarea",{value:_.description,onChange:e=>O({..._,description:e.target.value}),className:"w-full px-3 py-2 bg-gray-800 border border-gray-700 rounded-lg text-white focus:ring-2 focus:ring-brand-blue focus:border-transparent",placeholder:"Describe your habit...",rows:3})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Period"}),(0,a.jsxs)("select",{value:_.period,onChange:e=>O({..._,period:e.target.value}),className:"w-full px-3 py-2 bg-gray-800 border border-gray-700 rounded-lg text-white focus:ring-2 focus:ring-brand-blue focus:border-transparent",children:[(0,a.jsx)("option",{value:"daily",children:"Daily"}),(0,a.jsx)("option",{value:"weekly",children:"Weekly"}),(0,a.jsx)("option",{value:"monthly",children:"Monthly"})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{className:"flex items-center mb-4",children:[(0,a.jsx)("input",{type:"checkbox",id:"remind",checked:_.reminder.enabled,onChange:e=>O({..._,reminder:{..._.reminder,enabled:e.target.checked}}),className:"w-4 h-4 text-brand-blue bg-gray-800 border-gray-700 rounded focus:ring-brand-blue focus:ring-2"}),(0,a.jsx)("label",{htmlFor:"remind",className:"ml-2 text-sm font-medium text-gray-300",children:"Enable Reminder"})]}),_.reminder.enabled&&(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Reminder Time"}),(0,a.jsx)("input",{type:"datetime-local",value:_.reminder.time,onChange:e=>O({..._,reminder:{..._.reminder,time:e.target.value}}),className:"w-full px-3 py-2 bg-gray-800 border border-gray-700 rounded-lg text-white focus:ring-2 focus:ring-brand-blue focus:border-transparent",required:_.reminder.enabled})]})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-300",children:"Tags"}),(0,a.jsx)("div",{className:"min-h-[40px] p-2 bg-gray-800 border border-gray-700 rounded-lg mb-2",children:(0,a.jsx)("div",{className:"flex flex-wrap gap-2",children:_.tags.map(e=>(0,a.jsxs)("span",{className:"inline-flex items-center gap-1 px-3 py-1 rounded-full text-sm font-medium transition-all ".concat(X(e)," animate-fadeIn"),children:[e,(0,a.jsx)("button",{type:"button",onClick:()=>er(e),className:"hover:text-white transition-colors duration-200","aria-label":"Remove ".concat(e," tag"),children:"\xd7"})]},e))})}),(0,a.jsxs)("div",{className:"flex flex-wrap gap-2 mb-2",children:[S.map(e=>(0,a.jsx)("button",{onClick:()=>{_.tags.includes(e.name)||O(t=>({...t,tags:[...t.tags,e.name]}))},className:"inline-flex items-center px-3 py-1 rounded-full text-sm font-medium transition-all ".concat(_.tags.includes(e.name)?"bg-brand-blue/20 text-brand-blue ring-2 ring-brand-blue":"".concat(X(e.name)," hover:ring-2 hover:ring-white/50")),children:e.name},e.id)),(0,a.jsxs)("button",{onClick:()=>f(!0),className:"inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-gray-700 hover:bg-gray-600 transition-all",children:[(0,a.jsx)("svg",{className:"w-4 h-4 mr-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})}),"Manage Tags"]})]}),(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)("input",{type:"text",value:C,onChange:e=>q(e.target.value),onKeyDown:e=>{"Enter"===e.key&&C.trim()&&(e.preventDefault(),_.tags.includes(C.trim())||O(e=>({...e,tags:[...e.tags,C.trim()]})),q(""))},className:"w-full px-3 py-2 bg-gray-800 border border-gray-700 rounded-lg text-white focus:ring-2 focus:ring-brand-blue focus:border-transparent",placeholder:"Type a tag and press Enter"}),C&&(0,a.jsx)("div",{className:"absolute right-2 top-1/2 -translate-y-1/2 text-xs text-gray-400",children:"Press Enter to add"})]})]}),(0,a.jsxs)("div",{className:"flex gap-4 pt-4",children:[(0,a.jsx)("button",{type:"button",onClick:()=>h(!1),className:"flex-1 px-4 py-2 bg-gray-800 text-white rounded-lg hover:bg-gray-700 transition-colors",children:"Cancel"}),(0,a.jsx)("button",{type:"submit",className:"flex-1 px-4 py-2 bg-brand-blue text-white rounded-lg hover:bg-opacity-90 shadow-[0_0_15px_rgba(29,99,255,0.5)] hover:shadow-[0_0_20px_rgba(29,99,255,0.7)] transition-all duration-300",children:"Create Habit"})]})]})]})}),p&&y&&(0,a.jsx)("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50",children:(0,a.jsxs)("div",{className:"bg-gray-900/90 rounded-xl p-6 w-full max-w-md m-4 shadow-xl border border-gray-800",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,a.jsx)("h2",{className:"text-xl font-semibold text-white",children:"Edit Habit"}),(0,a.jsx)("button",{onClick:()=>{b(!1),v(null)},className:"text-gray-400 hover:text-white transition-colors",children:"✕"})]}),(0,a.jsxs)("form",{onSubmit:Q,className:"space-y-6",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Habit Name"}),(0,a.jsx)("input",{type:"text",value:y.title,onChange:e=>v({...y,title:e.target.value}),className:"w-full px-3 py-2 bg-gray-800 border border-gray-700 rounded-lg text-white focus:ring-2 focus:ring-brand-blue focus:border-transparent",placeholder:"e.g., Morning Meditation",required:!0})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Description"}),(0,a.jsx)("textarea",{value:y.content,onChange:e=>v({...y,content:e.target.value}),className:"w-full px-3 py-2 bg-gray-800 border border-gray-700 rounded-lg text-white focus:ring-2 focus:ring-brand-blue focus:border-transparent",placeholder:"Describe your habit...",rows:3})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Period"}),(0,a.jsxs)("select",{value:y.period,onChange:e=>v({...y,period:e.target.value}),className:"w-full px-3 py-2 bg-gray-800 border border-gray-700 rounded-lg text-white focus:ring-2 focus:ring-brand-blue focus:border-transparent",children:[(0,a.jsx)("option",{value:"daily",children:"Daily"}),(0,a.jsx)("option",{value:"weekly",children:"Weekly"}),(0,a.jsx)("option",{value:"monthly",children:"Monthly"})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{className:"flex items-center mb-4",children:[(0,a.jsx)("input",{type:"checkbox",id:"remind-edit",checked:null===(e=y.reminder)||void 0===e?void 0:e.enabled,onChange:e=>{var t,r;return v({...y,reminder:{...y.reminder,enabled:null!==(r=null===(t=y.reminder)||void 0===t?void 0:t.enabled)&&void 0!==r&&r,time:e.target.value}})},className:"w-4 h-4 text-brand-blue bg-gray-800 border-gray-700 rounded focus:ring-brand-blue focus:ring-2"}),(0,a.jsx)("label",{htmlFor:"remind-edit",className:"ml-2 text-sm font-medium text-gray-300",children:"Enable Reminder"})]}),(null===(t=y.reminder)||void 0===t?void 0:t.enabled)&&(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Reminder Time"}),(0,a.jsx)("input",{type:"datetime-local",value:y.reminder.time,onChange:e=>{var t,r;return v({...y,reminder:{...y.reminder,enabled:null!==(r=null===(t=y.reminder)||void 0===t?void 0:t.enabled)&&void 0!==r&&r,time:e.target.value}})},className:"w-full px-3 py-2 bg-gray-800 border border-gray-700 rounded-lg text-white focus:ring-2 focus:ring-brand-blue focus:border-transparent",required:y.reminder.enabled})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Tags"}),(0,a.jsx)("div",{className:"flex flex-wrap gap-2 mb-2",children:null===(r=y.tags)||void 0===r?void 0:r.map(e=>(0,a.jsxs)("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-sm font-medium ".concat(X(e.name)),children:[e.name,(0,a.jsx)("button",{type:"button",onClick:()=>G(e),className:"ml-1.5 hover:text-white",children:"\xd7"})]},e.id))}),(0,a.jsx)("input",{type:"text",value:E,onChange:e=>I(e.target.value),onKeyDown:e=>{if("Enter"===e.key&&E.trim()&&y){var t;e.preventDefault();let r={id:Date.now().toString(),name:E.trim(),entry_id:y.id,user_id:y.user_id,createdat:new Date().toISOString()};(null===(t=y.tags)||void 0===t?void 0:t.some(e=>e.name===E.trim()))||v({...y,tags:[...y.tags||[],r]}),I("")}},className:"w-full px-3 py-2 bg-gray-800 border border-gray-700 rounded-lg text-white focus:ring-2 focus:ring-brand-blue focus:border-transparent",placeholder:"Type a tag and press Enter"})]}),(0,a.jsxs)("div",{className:"flex gap-4 pt-4",children:[(0,a.jsx)("button",{type:"button",onClick:()=>$(y.id),className:"flex-1 px-4 py-2 bg-red-600/80 text-white rounded-lg hover:bg-red-600 transition-colors",children:"Delete Habit"}),(0,a.jsx)("button",{type:"button",onClick:()=>{b(!1),v(null)},className:"flex-1 px-4 py-2 bg-gray-800 text-white rounded-lg hover:bg-gray-700 transition-colors",children:"Cancel"}),(0,a.jsx)("button",{type:"submit",className:"flex-1 px-4 py-2 bg-brand-blue text-white rounded-lg hover:bg-opacity-90 shadow-[0_0_15px_rgba(29,99,255,0.5)] hover:shadow-[0_0_20px_rgba(29,99,255,0.7)] transition-all duration-300",children:"Save Changes"})]})]})]})}),x&&(0,a.jsx)("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50",children:(0,a.jsxs)("div",{className:"bg-gray-900/90 rounded-xl p-6 w-full max-w-md m-4 shadow-xl border border-gray-800",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,a.jsx)("h2",{className:"text-xl font-semibold text-white",children:"Manage Tags"}),(0,a.jsx)("button",{onClick:()=>f(!1),className:"text-gray-400 hover:text-white transition-colors",children:"✕"})]}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsx)("div",{className:"flex flex-wrap gap-2",children:S.map(e=>(0,a.jsxs)("div",{className:"inline-flex items-center gap-2 px-3 py-1 rounded-full text-sm font-medium ".concat(X(e.name)),children:[e.name,(0,a.jsx)("button",{onClick:async()=>{await l.O.from("tags").delete().eq("name",e.name).eq("user_id",null==d?void 0:d.id),V()},className:"hover:text-white transition-colors duration-200",children:"\xd7"})]},e.id))}),(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)("input",{type:"text",value:C,onChange:e=>q(e.target.value),onKeyDown:async e=>{if("Enter"===e.key&&C.trim()){e.preventDefault();let t={name:C.trim(),user_id:null==d?void 0:d.id,createdat:new Date().toISOString()};await l.O.from("tags").insert([t]),q(""),V()}},className:"w-full px-3 py-2 bg-gray-800 border border-gray-700 rounded-lg text-white focus:ring-2 focus:ring-brand-blue focus:border-transparent",placeholder:"Add a new tag and press Enter"}),C&&(0,a.jsx)("div",{className:"absolute right-2 top-1/2 -translate-y-1/2 text-xs text-gray-400",children:"Press Enter to add"})]})]})]})})]})}},18628:function(e,t,r){"use strict";r.r(t),r.d(t,{AuthProvider:function(){return l},useAuth:function(){return o}});var a=r(57437),n=r(2265),i=r(14958);let s=(0,n.createContext)({user:null,loading:!0,signOut:async()=>{}});function l(e){let{children:t}=e,[r,l]=(0,n.useState)(null),[o,d]=(0,n.useState)(!0),c=async()=>{let{error:e}=await i.O.auth.signOut();if(e)throw console.error("Error signing out:",e),e};return(0,n.useEffect)(()=>{i.O.auth.getSession().then(e=>{var t;let{data:{session:r}}=e;l(null!==(t=null==r?void 0:r.user)&&void 0!==t?t:null),d(!1)});let{data:{subscription:e}}=i.O.auth.onAuthStateChange((e,t)=>{var r;l(null!==(r=null==t?void 0:t.user)&&void 0!==r?r:null),d(!1)});return()=>e.unsubscribe()},[]),(0,a.jsx)(s.Provider,{value:{user:r,loading:o,signOut:c},children:t})}let o=()=>(0,n.useContext)(s)},91389:function(e,t,r){"use strict";r.r(t),r.d(t,{SidebarProvider:function(){return s},useSidebar:function(){return l}});var a=r(57437),n=r(2265);let i=(0,n.createContext)(void 0);function s(e){let{children:t}=e,[r,s]=(0,n.useState)(!1);return(0,a.jsx)(i.Provider,{value:{isCollapsed:r,setIsCollapsed:s},children:t})}function l(){let e=(0,n.useContext)(i);if(void 0===e)throw Error("useSidebar must be used within a SidebarProvider");return e}},14958:function(e,t,r){"use strict";r.d(t,{O:function(){return l}});var a=r(54566);let n="https://dkvaspqbakjcwaxivtqo.supabase.co",i="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImRrdmFzcHFiYWtqY3dheGl2dHFvIiwicm9sZSI6ImFub24iLCJpYXQiOjE3MzcxMjk4NzcsImV4cCI6MjA1MjcwNTg3N30.dcVtOCJWN17M9K5MFMk6cRNugze9Dw-JnlTniPrFONI\n";if(!n||!i)throw Error("Missing Supabase environment variables");let s=n.trim(),l=(0,a.eI)(s,i,{auth:{persistSession:!0,autoRefreshToken:!0},db:{schema:"public"}})},24033:function(e,t,r){e.exports=r(15313)}},function(e){e.O(0,[382,2971,4938,1744],function(){return e(e.s=24172)}),_N_E=e.O()}]);